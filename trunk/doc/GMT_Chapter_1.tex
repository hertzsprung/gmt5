%------------------------------------------
%	$Id: GMT_Chapter_1.tex,v 1.52 2006-10-28 23:51:45 pwessel Exp $
%
%	The GMT Documentation Project
%	Copyright 2000-2006.
%	Paul Wessel and Walter H. F. Smith
%------------------------------------------
%
\chapter{Preface} 
\label{ch:1}
\thispagestyle{headings}

While \GMT\ has served the map-making and data processing needs of scientists since 1988\footnote{Version
1.0 was then informally released at the Lamont-Doherty Earth Observatory.}, the current global use was
heralded by the first official release in {\it EOS Trans. AGU} in the fall of 1991.  Since then,
\GMT\ has grown to become a standard tool for many users, particularly in the Earth and Ocean Sciences.
Development has at times been rapid, and numerous releases have seen the light of day since the early
versions.  For a history of the changes from release to release, see the online
\htmladdnormallink{Release Announcements}{http://gmt.soest.hawaii.edu/gmt/gmt_releases.html}
and the file \filename{CHANGES} in the main \GMT\ directory.

The success of \GMT\ is to a large degree due to the input of the user community. In fact, most of the
capabilities and options in \GMT\ programs originated as user requests.
We would like to hear from you should you have any suggestions for future enhancements and modification.
Please send your comments to
\htmladdnormallink{the GMT help list}{mailto:gmt-help@hawaii.edu}.

\section{What is new in \gmt\ 4.x?}

\GMT\ 4.x continues to see both development of new features as well as corrections of
legacy bugs and problems.  It is likely we will continue to do so for a while until we
reach a stable point from which we can initiate the \GMT\ 5 development branch.  \GMT\ 5
will be distinguished by being completely restructured so as to allow developers to call
high-level \GMT\ processes from a variety of programming environments.  Below is a brief
history of the development milestones in the 4.x series.

\subsection{Overview of \gmt\ 4.1.4 [Nov-1, 2006]}

Changes in \GMT\ 4.1.4 are again relatively minor and predominantly bug fixes.  One imporant
new feature is that \GMT\ can now automatically recognize the format of the grd file given
to a program.  The use of the ``=id'' mechanism is now only needed when writing an output file in
a grid format other than the netCDF default.  We have also added
a new user directory pointed to by {\bf GMT\_USERDIR} (default directory is \filename{\~/.gmt})
where items such as \filename{.gmtdefaults4} will be looked for.  Additionally, a few enhancements
have been made to overcome limitations in the previous versions:

\begin{enumerate}
\item \GMTprog{grd2cpt} has a new option \Opt{T} for the creation of tables symmetric about zero.
\item \GMTprog{grdblend} will accept negative weights which are taken to mean that the sense of tapering should be reversed.
\item \GMTprog{grdedit} has a new option \Opt{E} to transpose the entire grid.
\item \GMTprog{grdreformat} now supports the \Opt{f} option.
\item \GMTprog{nearneighbor} will now optionally accept a {\it min\_sectors} argument appended to the \Opt{N} option.
\item \GMTprog{pshistogram}'s option \Opt{I} can now accept a modifier {\bf O} to output all bin data even if $y = 0$.
\item \GMTprog{psscale} will now invert the color scale if a negative length is provided, and if
\Opt{I} is given when \Opt{L}{\it gap} is in effect we will modify the constant colors accordingly.
\item \GMTprog{psxy} and \item \GMTprog{psxyz} have a new option \Opt{Sj}$|${\bf J} that plots a rotatable
rectangle but otherwise behaves similarly to \Opt{Se}$|${\bf E}.
\item \GMTprog{misc/ps2raster} has many improvements; added EPS output; high-quality PDF output.
Also removed -dDOINTERPOLATE option which caused inversion of colour map and had no benefits.
\end{enumerate}

Below is a list of previous problems (some accidentily introduced in \gmt\ 4.1.3)
that we have identified and corrected in the current release:

\begin{description}
\item [\GMTprog{gmt\_agc.c}]: AGC grids use 0 to represent NaNs -- this was not implemented yet.
\item [\GMTprog{gmt\_calclock.c}]: Proper rounding of time when converting to dates.
\item [\GMTprog{gmt\_support.c}]: Fixed bug in \Opt{I} when modifier {\bf =} was used.
\item [\GMTprog{gmt\_init.c}]: Fixed bug not recognizing {\bf PAGE\_ORIENTATION} as well as a bug that
prevented proper writing of {\bf PAGE\_ORIENTATION} in defaults.  Added a check so \GMTprog{gmtset}
will not crash if VALUE is not given.  Finally, let {\bf GMT\_HOMEDIR} default to C: under Windows
if {\bf HOME} is not set.
\item [\GMTprog{gmt\_grdio.c}]: Set [xy]\_units also in \GMTfunc{GMT\_update\_grd\_info}.
\item [\GMTprog{gmt\_nc.c}]: Made sure no garbage remains under Cygwin when using \GMTfunc{strncpy}.
\item [\GMTprog{gmt\_plot.c}]: Bugs related to annotations with \Opt{JPa} and its {\bf z} modifier fixed.
Log gridlines did not work for 3-D view.  3-D axis label would sometimes get misplaced due to round-off.
3-D map scale did not project correctly.  Duplicate title could appear if \Opt{JX} was used and one axis was geographic (d).
Needed to add secondary font to list to be encoded.
\item [\GMTprog{pslib.c}]: Fixed memory management in LZW compression (memory leak).  Improved EPS conformance.
\item [\GMTprog{filter1d}]: Robust option used extreme rather than median to determine the outliers.
\item [\GMTprog{gmtconvert}]: Did not have \Opt{L} listed in synopsis.
\item [\GMTprog{grdblend}]: Now skip grids that are entirely outside the region of interest.
\item [\GMTprog{grdcontour}]: Crashed if \Opt{M} and \Opt{D} were used with no file name specified.
\item [\GMTprog{grdcut}]: Require geographical instead of global in order to shift by 360 degrees.
\item [\GMTprog{grdfilter}]: Should not wrap over pole unless grid extends all the way to the pole.
\item [\GMTprog{grdinfo}]: When \Opt{C} was used there was no linefeed at the end.
\item [\GMTprog{grdsample}]: \Opt{T} did not ignore \Opt{R} (as per manual), resulting is changed cell size.
\Opt{F} did not use grid registration as default, rather that of input grid.
When using pixel registration, number of cells would be one too large.
\Opt{L} worked only in very limited case: going from x=[-180;180] to x=[0;360].
Now supports any periodicity in X and Y (as per manual). \Opt{F} again forces pixel registration.
Default is same as input.  More consistency with manual.
\item [\GMTprog{grdtrack}]: The \Opt{Z} option failed to be set for some input configurations.
\item [\GMTprog{grdvector}]: Added \Opt{f} option.
\item [\GMTprog{grdvolume}]: Three bugs squashed: gridcell oriented grids now get proper area and volume,
including edges; only one cell per NaN is excluded; when \Opt{C} and \Opt{L} are combined,
the volume is properly corrected for the baseline height.
\item [\GMTprog{pscoast}]: \Opt{N} and \Opt{I} reset pens to default settings after initially changing them.
Did not change output mode to binary (Windows only) if \Opt{M} and \Opt{b} were set.
\item [\GMTprog{pscontour}]: The \Opt{D} dump option wrote projected instead of original coordinates.
\item [\GMTprog{pslegend}]: Did not replace octagons with polygon form when pattern was requested.
Did not consider if absolute coordinates were given in \Opt{X} and \Opt{Y}. Passed the wrong character code
when {\bf M} was chosen with a plain scale modifier.
\item [\GMTprog{psscale}]: A vertical bar with a label placed along it was mis-justified.
\item [\GMTprog{pstext}]: Default for \Opt{G} is now {\bf BASEMAP\_FRAME\_RGB} as for other map annotations.
\item [\GMTprog{psxyz}]: \Opt{C} for symbols did not pick up color fill.
\item [\GMTprog{trend2d}]: Processing of \Opt{F} happened after checking.
\item [\GMTprog{xyz2grd}]: Had \Opt{Az} as default rather than no \Opt{A}.  Fixed bad header parsing when \Opt{E} was selected.
\item [\GMTprog{dbase/grdraster}]: Only do 360-degree wrapping if working on a geographic grid.
\item [\GMTprog{mgd77/mgd77list}]: Did not process time when \Opt{Am}2$|$4 was set and time was not requested as output.
Also, did not process time when \Opt{Am}2$|$4 was set and time was not requested as output.
\item [\GMTprog{x2sys/x2sys}]: Did not look in current dir for *.def files.
\end{description}

%-----------------------------------------
\subsection{Overview of \gmt\ 4.1.3 [June-1, 2006]}

Changes in \GMT\ 4.1.3 are relatively minor and predominantly bug fixes.  However, a few enhancements
have been made to overcome limitations in the previous versions:

\begin{enumerate}
\item Added the Hughes 1980 ellipsoid for projection support for DMSP SSM/I grid products.
\item \GMTprog{grdfft} has an extended \Opt{F} option to allow for either Gaussian- or
cosine-tapered filtering.
\item \GMTprog{psscale} now has a \Opt{Q} option so that logarithmic color scales and annotations
can be handled properly.
\item \GMTprog{makecpt} and \GMTprog{grd2cpt} have a new \Opt{M} option to allow the background, foreground, and
NaN-colors to be assigned using the \GMT\ defaults instead of the settings in the master CPT file. 
\item \GMTprog{mgd77list} in the {\bf mgd77} supplement has new option \Opt{Q} to specify limits on
speed and azimuths for output records.
\end{enumerate}

Below is a list of previous problems (some accidentily introduced in \gmt\ 4.1.2)
that we have identified and corrected in the current release:

\begin{description}
\item [\GMTprog{gmt\_grdio.c}]: Bug in \GMTfunc{GMT\_grd\_shift} for gridline-registered grids; this function is used in
\GMTprog{grdedit} to rotate grids of 360-degree longitudinal extent. Also added better testing for subsets of global (0-360) grids.
\item [\GMTprog{gmt\_init.c}]: \GMTfunc{GMT\_PS\_init} was called after --PAR=val had been decoded, resetting
the \PS-related parameters to their default settings.
\item [\GMTprog{gmt\_support.c}]: \GMTfunc{GMT\_set\_xy\_domain} padded region for pixel instead of grid registration,
which could cause SEGV in \GMTprog{xyz2grd} if ({\it x,y}) was less than half the grid-spacing outside region.
\item [\GMTprog{blockmean.c}]: The \Opt{C} option got reversed in 4.1.2 - now fixed.
\item [\GMTprog{blockmedian.c}]: The \Opt{C} option got reversed in 4.1.2 - now fixed.
\item [\GMTprog{grdcontour.c}]: The \Opt{C} option with a non-cpt file failed to read due to lack of proper if-test.
\item [\GMTprog{grdedit.c}]: The \Opt{S} option was backwards and tested {\it w-e}=360; should be {\it e-w}=360.
\item [\GMTprog{grdimage.c}]: Fixed bug introduced by \GMTfunc{GMT\_get\_inc} in 4.1.2. Internal projected
grid never took node\_offset from input grid.
\item [\GMTprog{grdmask.c}]: Polygons with zig-zag shape would sometimes cause a node exactly
on a polygon vertex to be considered inside. Radius was reset to 0 after \Opt{S}{\it radius} was assigned.
\item [\GMTprog{grdvector.c}]: The \Opt{A} option was not properly initiated.
\item [\GMTprog{psbasemap.c}]: The \Opt{L} option did not properly parse the optional :label:<just> part.
\item [\GMTprog{pslegend.c}]: If the {\bf M} (for map scale) was used, the \Opt{R} and \Opt{J} options would be reset.
Also prevented the undoing of \Opt{X} and \Opt{Y} at the end of the program.
\end{description}

%-----------------------------------------

\subsection{Overview of \gmt\ 4.1.2 [May-15, 2006]}

On the surface, changes in \GMT\ 4.1.2 are relatively minor.  Most of the work has involved
realignment of code and parsing of arguments to simplify the upcoming port to \GMT\ 5;
a brief listing of more visible changes include

\begin{enumerate}
\item Coastline files have been updated to use GSHHS version 1.4 which fixes minor inconsistencies
in the coastline database.
\item All coastline files are now stored in a new subdirectory \filename{coast} under the
\filename{share} directory, and the tar archives for coastlines now have their own version numbers
as they do not change as frequently as the source code.  Current coastline version number is 4.1.
\item The archives have been reorganized so that \filename{GMT\_share.*} contains all files needed
at runtime whereas the standard coastline files are in the new \filename{GMT\_coast.*} archive.
The \filename{GMT\_progs.*} archive has been renamed \filename{GMT\_src.*}.
\item CPT files can now have {\it z}-values that are date-time strings.
\item Optionally append {\bf z} to the \Opt{Jp} projection to annotate depths (i.e., ``north-y'') rather than radius.
\item Two new tools added to the {\bf misc} supplement for digitizing lines (\GMTprog{gmtdigitize.c}) and
to stitch digitized lines into continuous lines or polygons (\GMTprog{gmtstitch.c}).
\item Extended \Opt{M} option to take optional modifiers {\bf i} or {\bf o} for input or output.
\item Added support for custom grd format AGC from Atlantic Geoscience Center, assigned the code {\bf af} [21].
\end{enumerate}

A few programs or options have received minor updates and new features, such as

\begin{description}
\item [\GMTprog{blockmean.c}]: Added \Opt{E} for reporting standard deviation, min, and max values per block.
\item [\GMTprog{blockmedian.c}]: Added \Opt{E} for reporting L1 scale, min, and max values per block.
Also added \Opt{T} to specify a particular quartile [Default {\it q} = 0.5 = median].
\item [\GMTprog{blockmode.c}]: Added \Opt{E} for reporting LMS scale, min, and max values per block.
\item [\GMTprog{configure}]: Added explicit options to bypass the installation of supplements
that require Matlab (--disable-mex) and X11 (--disable-xgrid).
\item [\GMTprog{gmtconvert.c}]: Added \Opt{D} option to write segments to individual output files.
\item [\GMTprog{gmtdefaults.c}]: Support for new default {\bf PS\_VERBOSE} which controls the
writing of comments to \PS\ files.  {\bf COLOR\_MODEL} can now accept a prefix ``+'' which
forces color interpolation in the selected system (RGB or HSV only).  Default remains RGB.
{\bf PS\_COLOR} has been extended to accept HSV as well (only applies to
polygon, symbol, pen, and text colors, not images.).  New parameter {\bf POLAR\_CAP} which
controls the number of gridlines that converge on the poles for azimuthal and some other projections.
Added new default {\bf HISTORY} [TRUE] which controls whether or not we maintain a common command option
history via .gmtcommands4 files.
\item [\GMTprog{gmtmath.c}]: Added option \Opt{M} to indicate the program can now handle multisegment files.
Added {\bf CPOISS} for cumulative Poisson distribution.
\item [\GMTprog{grdmath.c}]: Added {\bf CPOISS} for cumulative Poisson distribution.
\item [\GMTprog{minmax.c}]: \Opt{D} made obsolete by improved range checking for longitudes (but available for
backwards compatibility).
\item [\GMTprog{psscale.c}]: Enhanced \Opt{I} option for asymmetrical intensity ranges from {\it low} to {\it high}.
\item [\GMTprog{psxy.c}]: Added \Opt{SW} for wedges defined by azimuths rather than directions.  Polygons of large
longitudinal extent now clip correctly.
\item [\GMTprog{splitxyz.c}]: New option \Opt{Q} to specify the output columns and their order.
\end{description}

Below is a list of previous problems
that we have identified and corrected in the current release:

\begin{description}
\item [\GMTprog{gmt\_plot.c}]: The 3-D perspective plotting of text was not scaled correctly.
\item [\GMTprog{gmt\_support.c}]: Parsing of \Opt{L} option used in \GMTprogi{psbasemap} and \GMTprogi{pscoast}
failed to get correct unit when ddd:mm:ss syntax was used for the position. Corner boundary conditions for grids (needed
by \GMTprog{grdtrack}, \GMTprog{grdsample}, \GMTprog{grdview}, and \GMTprog{grdgradient}) had the wrong sign.
\item [\GMTprog{gmt2rgb.c}]: Did not check name template properly, and did not initialize region.
\item [\GMTprog{gmtselect.c}]: Option \Opt{F} insisted on using spherical testing for Cartesian {\it x,y} data.
\item [\GMTprog{grd2xyz.c}]: The \Opt{E} option had the {\it y}-direction reversed.
\item [\GMTprog{grdfilter.c}]: Needed the \Opt{f} option to process \Opt{R}ddd:mm syntax.
\item [\GMTprog{grdimage.c}]: Would hang in {\it stdin} if \Opt{C} not given when one grid is plotted.
\item [\GMTprog{grdmask.c}]: Did not explicitly close polygons before using them.  Test for polar caps applied to the opposite pole.
\item [\GMTprog{grdmath.c}]: Command {\bf INSIDE} for Cartesian data had bug (passed {\it y} where {\it x} was expected).
\item [\GMTprog{grdsample.c}]: Failed when \Opt{I} was specified.
\item [\GMTprog{grdview.c}]: Bug in plotting north facade (\Opt{N}).  Also tried to free unallocated memory if \Opt{G} was used.
\item [\GMTprog{project.c}]: Cartesian projections gave incorrect results for {\it p,w,r,s}.
Removed 0--360 restriction on azimuth.  Option \Opt{G} was susceptible to round-off and thus
sometimes reissued the final point.
\item [\GMTprog{psxy.c}]: \Opt{SV} and \Opt{SE} for \Opt{JX} did not convert azimuths to directions.
The \Opt{Sq} option would get confused when distances between successive labels were smaller than the line's point spacing.
\item [\GMTprog{mgd77/mgd77manage.c}]: Did not properly close the file after ingesting E77 information.
\item [\GMTprog{pslib.c}]: \GMTfunc{ps\_load\_raster} did not use open mode {\bf rb} and hence failed under Windows.
\item [\GMTprog{xyz2grd.c}]: The \Opt{E} option had the {\it y}-direction reversed.
\item [\GMTprog{x2sys/x2sys\_get.c}]: \Opt{N} did not work properly (now fixed and tested).
\end{description}

%-----------------------------------------

\subsection{Overview of \gmt\ 4.1.1 [Mar-1, 2006]}

Changes in \GMT\ 4.1.1 are mostly minor; a brief listing include

\begin{enumerate}
\item \GMTprog{gmt\_nc.c}: Introduced handling of 4-D COARDS compliant grids (See Chapter 4 for details).
\item \GMTprog{mgd77/mngd77sniffer}: New tool for along-track quality control checking of MGD77 files.
\item \GMTprog{spotter/grdrotater}: New tool that rotates grids given a specified finite rotation.
\item Jonathan Shewchuk's triangulation routines are now stored with the rest of the source in the GMT\_progs.tar$|$zip archives.
(However, because his copyright is not GPL, installing it is still an option).
\end{enumerate}

A few programs or options have received minor updates and new features, such as

\begin{description}
\item [\GMTprog{grdedit}]: Added option \Opt{T} to toggle between gridline and pixel registrations (header only).
\item [\GMTprog{grdgradient}]: Implemented variation on Lambertian illumination.
\item [\GMTprog{grdmask}]: Now takes \Opt{S}{\it radius}[{\bf c$|$m$|$k$|$K}] as is done in \GMTprog{nearneighbor}.
\item [\GMTprog{gmtmath}]: If file is STDIN we read data from {\it stdin} and put the contents on the stack.
Also added \Opt{F} to select which columns to use for output [all].
\item [\GMTprog{grdtrack}]: Can now sample Sandwell/Smith IMG grids directly.
\item [\GMTprog{mgd77/mgd77.c}]: Added mechanism to search directories for files.
\item [\GMTprog{mgd77/mgd77list}]: Activated \Opt{X} option and associated machinery for applying data corrections.
\item [\GMTprog{psmask}]: -Now takes \Opt{S}{\it radius}[{\bf c$|$m$|$k$|$K}] as is done in \GMTprog{nearneighbor}.
Can now plot tiles regardless of projection and use patterns.
\item [\GMTprog{pstext}]: \Opt{D}[...]{\bf v}{\it pen} can now be used with or without \Opt{M}.
\item [\GMTprog{psxyz.c}]: \Opt{S}{\bf O}$|${\bf U} imitate \Opt{S}{\bf o}$|${\bf u} but without the 3-D color shading.
\end{description}

Inevitably, when new features are added, new bugs come along with them.  Below is a list of problems
that we have identified and corrected in the current release:.

\begin{description}
\item [\GMTprog{configure.in}]: Extracting VERSION from \GMTprog{gmt\_version.h}, not \GMTprog{gmt.h}.
\item [\GMTprog{gmt\_init.c}]: BASEMAP\_FRAME\_RGB overrode any changes to grid pens etc.  Now only
does so if prefixed by '+'.
\item [\GMTprog{gmt\_calclock.c}]: Did not allow \Opt{B}0 for time-axis.
\item [\GMTprog{gmt\_map.c}]: \Opt{JX}...{\bf d} now plots with WESN or degrees:minutes as per PLOT\_DEGREE\_FORMAT.
Map clip paths for \Opt{JE}{\it lon}/\PM 90 were no good.  Under certain circumstances, \GMTfunc{GMT\_non\_zero\_winding} might be passed
a polygon that was not closed, resulting in an error.  \Opt{JQ} would give garbage if central lon was way outside \Opt{R}.
\item [\GMTprog{gmt\_plot.c}]: \Opt{JX}...{\bf d} now plots with WESN or degrees:minutes as per PLOT\_DEGREE\_FORMAT.
\item [\GMTprog{gmt\_grdio.c}]: Changed logic to avoid false ``scale==0'' warning on Windows.
\GMTfunc{GMT\_open\_grd} (used in \GMTprog{grdblend}) reset scale to NaN.
Initialize header information at start of \GMTfunc{GMT\_read\_grd\_info}.
\item [\GMTprog{gmt\_support.c}]: Initialize [xyz]\_unit with more appropriate values.
Got wrong conversion for dx in meters to degrees.
\item [\GMTprog{gmt\_grd.h}]: Improved definition of \GMTfunc{GMT\_x\_to\_i} macro should reduce bugs
\item [\GMTprog{pslib.c}]: \GMTfunc{ps\_polygon}: if outline == -9 just fill and no clip.
Fixed two bugs concerning the /MaskColor operator.
\item [\GMTprog{ISO-8859-9.ps}]: Added /dotlessi per Onur Tan.
\item [\GMTprog{blockm*.c}]: Now correctly deals with periodic longitude data.
\item [\GMTprog{grdcontour.c}]: Fixed several issues at grid limits and inappropriate scaling of grid dimensions..
\item [\GMTprog{grdfilter.c}]: Used -1 as index flag instead of INT\_MIN.
\item [\GMTprog{grdimage.c}]: Fixed several issues at grid limits and inappropriate scaling of grid dimensions.
\item [\GMTprog{grdmask.c}]: Only let you change the value for outside nodes.
\item [\GMTprog{grdmath.man}]: Did not list \Opt{f} option.  Operators {\bf LT, LE, EQ, GE, GT} returned TRUE if NaNs were involved
Now NaN is returned if any of the two operands is a NaN.
\item [\GMTprog{grdreformat.c}]: Update grd.command before writing grid
\item [\GMTprog{grdvector.c}]: Did not place vectors correctly for pixel-pregistered grids.
\item [\GMTprog{grdview.c}]: Skipped nodes outside boundary but they might be needed to draw a tile.
\item [\GMTprog{pscoast.c}]: With \Opt{JE} and \Opt{G}{\it r/g/b}, the painting of the antipodal bin would incorrectly
turn off clipping, messing up the rest of the plot.  Now pass -9 to \GMTfunc{GMT\_fill} which means just fill and no end of clipping.
\item [\GMTprog{xyz2grd.c}]: For geographic grids with 360\DS\ range and gridline registration,
the west and east bin did not get replicated properly.
Now considers data inside the first and last tiles which might stick outside w/e/s/n.
\item [\GMTprog{x2sys/x2sys\_cross.c}]: Several problems fixed.
\end{description}

\subsection{Overview of \gmt\ 4.1 [Jan-7, 2006]}

Most changes in \GMT\ 4.1 are improvements ``under the hood''.  The most significant of these are

\begin{enumerate}
\item Addition of ability to both read and write netCDF files that are COARDS compliant.  This means
that \GMT, for the first time, is able to read netCDF files created by applications other than itself,
and that other applications capable of reading COARDS-compliant netCDF grids can directly import data
from \GMT.  We have added the new parameter {\bf GRID\_FORMAT} to the  \GMT\ defaults with ``nf'' as default.
Users who, against our recommendation, prefer to maintain the old non-COARDS compliant format as their
default grid format can instead select ``cf''. Support for extracting 2-D slices from 3-D netCDF grids has
also been added.
\item An overhaul of how the {\bf pslib} library encodes \PS\ images, resulting in vastly smaller files when
certain conditions are met, and general shrinking overall by enabling RLE or LZW compression.  We
have also added hooks for setting three new \PS\ parameters via \GMTprog{gmtdefaults} settings:
{\bf PS\_LINE\_CAP}, {\bf PS\_LINE\_JOIN}, and {\bf PS\_MITER\_LIMIT}. See \GMTprog{gmtdefaults} for details.
\item Improved alignment of strings ending in ``1'' in the \PS\ output.
\item Adjustments to how native \GMT\ grid headers are read and written in order to be fully 64-bit safe.
\GMT\ now runs in full 64-bit mode on platforms that supports it (e.g., Mac OS X G5).
\item Making \GMT\ tread-safe by replacing {\it strtok} with our own {\it GMT\_strtok} function.
\item Implemented full inverse Winkel map projection based on a new algorithm by Ipbuker, 2002,
{\it Cartography \& Geographical Information Science, 29}, 37-42.
\item Extended the options that is used to specify grid spacing (usually \Opt{I}{\it xinc/yinc}) to allow for
specifying {\it nx/ny} instead (by appending +).  Also, append ! to adjust the range so it fits exactly the
given increment [by default the range is kept fixed and sloppy increments are adjusted accordingly].
Append {\bf e}$|${\bf k}$|${\bf i}$|${\bf n} for increments in meter, km, miles
or nautical miles, respectively.  These increments are converted to degrees
longitude (at the middle latitude) and degrees latitude.
\item The polar $r, \theta$ projection \Opt{Jp} now takes an optional suffix {\bf r} that reverses the
radial coordinates (useful when $r$ is elevation as used by sky plots.)
\item The \GMTprog{misc} supplement has two new items: \GMTprog{ps2raster} uses \progname{ghostscript} to
fascilitate the rasterization of \PS\ files, while \GMTprog{nc2xy} allows extraction of data columns from
COARDS-compliant netCDF files.
\item The \GMTprog{mgd77} supplement has two new items: \GMTprog{mgd77convert} translates between different
MGD77 formats (including a new netCDF-based format), while \GMTprog{mgd77manage} assists in the management
of trackline data sets.
\item We now have improved PDF layout and navigation (thanks to Misha Tchernychev).
\item The HTML versions of all manual pages are now generated with \progname{groff}, and has active links
for \GMT\ Default parameters as they are references in the documentation.
\end{enumerate}

Many programs or options have received minor updates and new features, such as

\begin{description}
\item [\Opt{b}]: Ability to specify byte-swapping for native binary input and output tables by using upper
case {\bf S}$|${\bf D}.  This is useful if you have binary tables created on a little-endian machine (e.g.,
Linux PC) and need to read them on a big-endian machine (e.g., most RISC-chip machines from Sun, HP, Apple).
\item [\GMTprog{filter1d.c}]: Allow NaNs in all but the ``independent data'' column.
\item [\GMTprog{grdcontour.c}]: Label option {\bf +ap}[{\bf u}$|${\bf d}] for always having labels be readable up or down hills.
\item [\GMTprog{gmtconvert.c}]: New \Opt{N} option suppresses output records when all fields are NaNs.
\item [\GMTprog{gmtmath.c}]: Added {\bf TN} function
for evaluating Chebyshev polynomials; new constant {\bf Tn} was added to easily select normalized {\bf T}
(gives coordinates from -1 to + 1 suitable for evaluating Legendre and Chebyshev polynomials).
Finally, we added {\bf CORRCOEFF} for calculation of correlation coefficients, and \Opt{I} to reverse
the output by printing the last row first.
\item [\GMTprog{grd2cpt.c}]: New option \Opt{D} sets the back- and foreground colors to the colors at the limits of the cpt file.
\item [\GMTprog{grd2xyz.c}]: Added \Opt{E} for ESRI interchange ASCII grid dump.
\item [\GMTprog{grdfilter.c}]: Geographic boundary conditions are now in effect if \Opt{D4} is selected.
\item [\GMTprog{grdgradient.c}]: Added option \Opt{E} for Lambertian or Peuckeer illumination.
\item [\GMTprog{grdmath.c}]: Allow \Opt{bi} to be used with input files for commands {\bf PDIST}, {\bf LDIST},
and {\bf INSIDE}.  When spherical calculations are selected we now use the {\bf ELLIPSOID} setting to
determine if distance calculations should be along geodesics or great circles.  Also added {\bf TN} function
for evaluating Chebyshev polynomials; new constants {\bf Xn} and {\bf Yn} was added to easily select
normalized {\bf X} and {\bf Y}.  Finally, we added {\bf CORRCOEFF} for calculation of correlation coefficients.
\item [\GMTprog{grdraster.c}]: Optionally select a data set by giving a text pattern instead of data ID number.
This makes it easier to specify a certain data set (i.e., ``ETOPO2'') than having to remember its arbitrary numerical
ID.  Also, native grids with \GMT\ headers can also be placed in the database by appending {\bf H}{\it nbytes} to the
corresponding \filename{grdraster.info} entry, where {\it nbytes} is the size of the header that should be skipped
(use 892 for GMT headers).
\item [\GMTprog{makecpt.c}]: New option \Opt{D} sets the back- and foreground colors to the colors at the limits of the cpt file.
\item [\GMTprog{mapproject.c}]: \Opt{L} now outputs both the minimum distance and the coordinates
of the nearest point on the line.
\item [\GMTprog{pscoast.c}]: Added \Opt{Z} for 3-D map z-level (as in \GMTprog{psbasemap} and others).
\item [\GMTprog{pshistogram.c}]: New option \Opt{T}{\it col} lets user select any column to be used, starting
with 0 (first).  The old \Opt{2} option is retired (but remains accessible for backwards compatibility).  
\item [\GMTprog{psimage.c}]: Now support inclusion of EPS images.
\item [\GMTprog{pslegend.c}]: Added layout option {\bf B} for inserting color bars via \GMTprog{psscale}.
\item [\GMTprog{psscale.c}]: Now supports an optional {\bf ;}{\it label} at end of each line in cpt files.
If present this label will replace the default annotations when option \Opt{L} is used.
\item [\GMTprog{psxyz.c}]: Added \Opt{Q} to disable sorting of points based on distance.
\item [\GMTprog{sample1d.c}]: Allow NaNs in all but the ``independent data'' column.
\item [\GMTprog{xyz2grd.c}]: Added \Opt{E} for ESRI interchange ASCII grid digest.
\end{description}

Inevitably, when new features are added, new bugs come along with them.  Below is a list of problems
that we have identified and corrected in the current release:

\begin{description}
\item [\GMTprog{install\_gmt}]: No longer test netcdf installation since that can fail even when install was
successful [e.g., under Mac OS X Tiger].
\item [\GMTprog{gmt.h}]: \GMTfunc{GMT\_swab4} used {\tt unsigned long} instead of {\tt unsigned int} which could cause
64-bit problems.
\item [\GMTprog{gmt\_time\_system.h}]: Fixed MJD offsets by subtracting 10 days.
\item [\GMTprog{gmt\_calclock.c}]: time to hr,min,sec was vulnerable to round-off when optimized.  Also, {\it hh:mm} data
(without trailing {\it :ss}) would loose the minutes ({\it hh:mm:ss} was OK).
\item [\GMTprog{gmt\_grdio.c}]: Bug in scale/offset for \GMTprog{grdblend}'s row-by-row i/o.
\item [\GMTprog{gmt\_init.c}]: Would eat number with leading plus sign without checking if it actually was
a +\filename{gmtdefaults} file instruction; thus \GMTprog{gmtmath} could not see numbers such as +13.5.
Command line argument --{\bf BASEMAP\_FRAME\_RGB}={\it color} was not passed through to tick-, grid- and
annotation-properties.  \GMTfunc{GMT\_end} now frees memory used for hashing.  Did not use custom ellipsoid to set
DEG2M parameter so we got large errors for planets with significantly different radii.
\item [\GMTprog{gmt\_io.c}]: Bug in reading {\it yyyy}[/]{\it jjj} data fixed.  \GMTfunc{GMT\_lines\_init}
had trouble if 2000 segments had no data at all.  It also allocated 2000 points for each segment but never
deallocated the unused portions, thus running up memory fast.  \GMTfunc{GMT\_write\_segmentheader} wrote nothing
if input was binary and output is ASCII.  Fixed a few memory leaks.
\item [\GMTprog{gmt\_map.c}]: Azimuth to angle calculation for linear projections now properly handle different
scales in x and y. The calculation was also vulnerable to bad wrap-around, giving strange directions for
vectors in \GMTprog{psxy}. Geodesic distance calculation could get wrong quadrant.  
\item [\GMTprog{gmt\_plot.c}]: 360\DS\ polar basemaps could lack outline.  Direction for map roses were inaccurate.
Circle and $\theta$-$r$ boundaries did not allocate enough memory for arrays.  Would plot both -180 and +180 annotations
for periodic maps.
\item [\GMTprog{gmt\_shore.c}]: Must explicitly close polygons since inside/outside test in other programs expects it.
\item [\GMTprog{gmt\_support.c}]: Trouble extracting subregions of grid with {\it east} = 0.  Cartesian {\bf LDIST} failed
when mininum distance was requested (only done via \GMTprog{grdmath}).  Color names got truncated to 16 characters.
Improved workings of \GMTfunc{GMT\_sample\_cpt} in support of \GMTprog{makecpt}.  Fixed more memory leaks.
Bad LF/CR removal for \filename{coastline.conf} dir.
\item [\GMTprog{filter1d.c}]: \Opt{Ff} with even number of coefficients sometimes skip a coefficient.
\item [\GMTprog{gmtconvert.c}]: Missed first multisegment output header if input file was ASCII.
\item [\GMTprog{gmtmath.c}]: No longer have to say \Opt{Ca} if there is only one input column.  Did not understand
{\it date}{\bf T}{\it clock} as command line data.
\item [\GMTprog{gmtselect.c}]: If \Opt{M} is on and a portion of a segment is skipped, we must
reissue the multisegment header when segment resumes.  Now handles both Cartesian
and spherical polygons correctly.
\item [\GMTprog{grd2xyz.c}]: Sloppy \Opt{R} resulted in bad x,y values and sometimes allocation error.
\item [\GMTprog{grdfilter.c}]: Convolution filters now use correct area normalization.
\item [\GMTprog{grdgradient.c}]: If \Opt{M} is used with grids that include poles, ignore the poles
when normalizing the slopes.
\item [\GMTprog{grdimage.c}]: Cannot use \Opt{R} to extract subset when \Opt{J} is oblique.  Reverse log-axes did not work.
\item [\GMTprog{grdmask.c}]: Now handles both Cartesian and spherical correctly.
\item [\GMTprog{grdmath.c}]: Wrong sign in {\bf D2DY2}, and bogus value at {\it y = ymin}.  Now handles both Cartesian
and spherical polygons correctly.  Constants given on command line can now be absolute time, geographic coordinates, or
regular floating-point numbers.
\item [\GMTprog{grdtrack.c}]: Would fail to skip first two columns for ASCII input if dd:mm:ss format was used.
\item [\GMTprog{grdview.c}]: Cannot use \Opt{R} to extract subset when \Opt{J} is oblique.
\item [\GMTprog{grdvolume.c}]: \Opt{C}{\it low/high/delta} did not check for {\it low} < {\it high}, etc.
\item [\GMTprog{pscoast.c}]: Recursive painting could get tricked when boundaries were curved.
\item [\GMTprog{pslegend.c}]: Did not pass +\filename{gmtdefaults} and --{\bf PAR}={\it val} onto system calls.
\item [\GMTprog{psscale.c}]: Vertical annotations w/custom {\bf D\_FORMAT} were not aligned. Now uses more optimal means
to display the color bar, leading to smaller \PS\ files.  \Opt{E} did not flip sides when a negative width was used.
\item [\GMTprog{psxy.c}]: \Opt{Sp} is now a true point, but can also take an optional size.  Pentagon symbol had wrong
normalization scale.  If a fixed symbol size was given in \Opt{S}, with the symbol type supplied from file,
we would not scale symbols correctly if upper case symbols were given.
\item [\GMTprog{psxyz.c}]: Wrong index used in assigning color from cpt and in updating vector lengths.  If a fixed symbol
size was given in \Opt{S}, with the symbol type supplied from file,
we would not scale symbols correctly if upper case symbols were given
\item [\GMTprog{spectrum1d.c}]: Bugs in error expressions for admittance, gain, and phase have been corrected.
\item [\GMTprog{x2sys \& mgd77}]: Made DOS-format (CR/LF) tolerant.  Both supplements are now undergoing rapid
development.
\end{description}

\subsection{Overview of \gmt\ 4.0 [Oct-10, 2004]}

\GMT\ 4 represents a major overhaul of the package, hence the major version number increment.  There are four
categories of changes that have been implemented:
\begin{description}
\item [Time-series support.]  \GMT\ can now read and write time-series data where
the time coordinates are of the form {\it date}{\bf T}{\it clock}\footnote{Use standard
\UNIX\ tools such as \progname{awk} or \progname{perl} to reformat files should
your {\it date} and {\it clock} components reside in separate columns.}.  The formats
used for {\it date} and {\it clock} are under the user's control.  Both Gregorian
and ISO calendars are supported.  Frame annotation for time-series are now supported
via the \Opt{B} option; there are many new modifiers reflecting the vast number of
ways one may want to annotate time axes, including support for primary and secondary
annotation levels and the day- and month-names in numerous languages (send us the information
we need if your language is not supported).  The capability to handle time (in \Opt{R},
\Opt{J}, \Opt{B}, i/o, and plotting) required considerable changes ``under the hood'',
including the introduction of numerous new \GMTprog{gmtdefaults} parameters to make
the time series support as ``generic'' as we need it to be.
\item [New Tools.]  Three new tools have been added:
\begin{enumerate}
\item \GMTprog{gmt2rgb}: Makes red, green, and blue component gridfiles from an image (to be
used with new options for false color imaging or image draping by \GMTprog{grdimage} or \GMTprog{grdview}).
\item \GMTprog{grdblend}: Blends several partially over-lapping grdfiles into one combined grid.  Output
grid is written one row at the time so truly enormous grids can be created.
\item \GMTprog{pslegend}: Designs and plots elaborate legends on maps.
\end{enumerate}
\item [New Program Options.]  Many programs have received additional options or
features that enhances their usefulness:
\begin{itemize}
\item \GMTprog{blockmean}:	New option \Opt{Sw} will return weight sum while \Opt{Sz} returns
the data sums (i.e., it duplicates the previous \Opt{S} option).
\item \GMTprog{filter1d}:	New filters \Opt{Fl$|$L$|$u$|$U} that return extreme (min, max) values.
\item \GMTprog{gmtconvert}:	Added new options \Opt{F}, \Opt{A},  and \Opt{I} that simulate
\UNIX\ \progname{cut}, \progname{paste}, and \progname{tail} \Opt{r} (or \progname{tac}) capabilities.
Option \Opt{E} reports first and last point per segment only, \Opt{L} lists the segment headers only,
while \Opt{S} lists records from segments whose header matches a given text pattern.
\item \GMTprog{gmtmath}:	Added new operators for solving least squares problems ({\bf COL, LSQFIT}),
finding function roots ({\bf ROOTS}), and evaluating critical values ({\bf CHICRIT, FCRIT, TCRIT, ZCRIT}).
We also added some general functions ({\bf SINC, LOG2, LRAND}) and miscellaneous operations ({\bf FLIPUD, NEQ}).
The \Opt{S} option may now take a modifier to select first or last record only.
\item \GMTprog{gmtselect}:	New option  \Opt{Z} to pass or skip based on input $z$-range.
\item \GMTprog{grd2cpt}:	New options  \Opt{Q} for logarithmic scales, \Opt{E} for equidistant color
intervals, \Opt{R} for selecting a grid sub-region, and \Opt{N} to suppress output of B, F, N colors\footnote{Used
to color the background, foreground, and Not-a-Number areas.}.
\item \GMTprog{grd2xyz}:	New option \Opt{W} to write a constant weight factor as a 4th output column,
and ability to process several grid files at the same time.
\item \GMTprog{grdcontour}:	Expanded the \Opt{G} option to handle 5 algorithms (4 new) for the placement
of contour labels. 
\item \GMTprog{grdedit}:	New option \Opt{N} to replace selected node values given {\it x, y, z} data
in table form (options \Opt{H}, \Opt{b}, \Opt{f}, and \Opt{:} added for file support).
\item \GMTprog{grdfilter}:	New geospatial filters \Opt{Fl$|$L$|$u$|$U} that return extreme (min, max) values. 
\item \GMTprog{grdimage}:	New option for colormasking (\Opt{Q}; \PS\ Level 3 only), \PS\ image 
interpolation (\Opt{E}{\it -dpi}), and false RGB color image (when given three grids), as well as a modifier to \Opt{T}
to draw tile outlines.
\item \GMTprog{grdinfo}:	New option to create argument for \GMTprog{makecpt} (\Opt{T}) and to round-off
region boundary coordinates (\Opt{I}). 
\item \GMTprog{grdmath}:	Added new operators for critical values ({\bf CHICRIT, FCRIT, TCRIT, ZCRIT}),
geospatial analysis ({\bf LDIST,  PDIST, INSIDE}) and for calculating azimuths ({\bf CAS, SAZ}).  We have
also added some general functions ({\bf SINC, LOG2, LRAND}) and a few grid operations ({\bf FLIPLR, FLIPUD, ROTX, ROTY, NEQ,
INRANGE}).  We may now create multiple output grids from a single command.
\item \GMTprog{grdproject}: Option to supply false easting/northing or other offsets from the origin(\Opt{C}).
\item \GMTprog{grdreformat}: Option to suppress header in raw output (\Opt{N}).
\item \GMTprog{grdsample}:	Option to push the bilinear interpolation closer to nodes that are NaN (\Opt{Q}).
\item \GMTprog{grdtrack}:	Options to retrieve nearest node value (\Opt{N}, no interpolation) and to push
the bilinear interpolation closer to nodes that are NaN (\Opt{Q}).
\item \GMTprog{grdview}:	Colormasking (\Opt{Qc}, PS Level 3 only), draping of images via red, green,
and blue component grids (\Opt{G}).  Also,  drapegrids can have higher resolution than the relief grid, and we
added a modifier to \Opt{T} to draw tile outlines.
\item \GMTprog{makecpt}:	New options \Opt{Q} for logarithmic scales and \Opt{N} to suppress output
of B, F, N colors.
\item \GMTprog{mapproject}:	New options for datum conversions (\Opt{T}, \Opt{E}, and \Opt{Q}), azimuth and
back-azimuth (\Opt{A}), distance to point (\Opt{G}) and line  (\Opt{L})calculations, and optional false easting/northing (\Opt{C}).
\item \GMTprog{minmax}:		Added \Opt{T}{\it dz} option to produce \Opt{T} string for \GMTprog{makecpt},
\Opt{E} for returning extreme records, and the \Opt{I} option was extended to handle any number of columns when \Opt{C} is used.
\item \GMTprog{psbasemap}:	Extended \Opt{L} to allow alternate label and justification, and added \Opt{T}
for directional rose ornament or magnetic compass directions.
\item \GMTprog{pscoast}:	Extended \Opt{L} to allow alternate label and justification, and added \Opt{T}
for directional rose ornament or magnetic compass directions.
\item \GMTprog{pscontour}:	Expanded the \Opt{G} option to handle 5 algorithms (4 new) for the placement
of contour labels. 
\item \GMTprog{psimage}:	\PS\ image interpolation (\Opt{W}{\it -xlength}), and justification option
in \Opt{C}.
\item \GMTprog{psscale}:	Options to annotate on opposite side (\Opt{A}) and to plot back or foreground
triangle only (\Opt{E}[{\bf b$|$f}] ).  Also, draw discrete color-key table with centered annotations by appending an optional
{\it gap} to the \Opt{L} option. 
\item \GMTprog{pstext}: 	New option \Opt{A} should azimuths rather than angles be given,
\item \GMTprog{psxy}: 	Line color control (via \Opt{C}), symbol position offset (with \Opt{D}), custom symbols access 
(with \Opt{Sk}; use any of the 35 (Appendix~\ref{app:N}) that come with \GMT\ or design your own), many new symbols (horizontal and vertical dashes,
pentagon, octagon, rectangle, double-headed and centered vectors), and annotated (``quoted'') lines with \Opt{Sq}.
\item \GMTprog{psxyz}: 	Same, plus a vertical dash symbol.
\item \GMTprog{xyz2grd}: 	Added \Opt{Au$|$l} for upper/lower value at each node.
\end{itemize}
\item [General enhancements.]  These affect most of the programs:
\begin{itemize}
\item The coastline data have been updated to GSHHS version 1.3.  About 50 or so polygons had lingering
crossovers and some had duplicate points or failed to close; these have now been fixed. Major
errors in the Puget Sound coastline have also been corrected.
\item New shorthand to repeat the most recently used projection (\Opt{J}).
\item Options for phase-shifting the stride and supplying a prefix for frame annotations (\Opt{B}).
\item Override \GMT\ defaults directly on the command line with any number of {--}{--}\emph{PAR=value} options.
\item Now choose from 63 ellipsoids and 223 datums, or use your own values.
\item Numerous new \GMT\ defaults parameters, mostly in support of time-series functionality.
\item Shorthand for global regions (\Opt{Rg} for \Opt{R}0/360/-90/90 and \Opt{Rd} for \Opt{R}-180/180/-90/90).
\item Full support for either RGB, HSV, or CMYK in pen/fill command-line options or in cpt files.
\item Support for English color names (e.g., red, lightbrown).
\item Choice of unit when specifying pen thickness (cm, inch, point).
\item Easier pen specification mechanism, with predefined names for certain pen thicknesses.
\item Centering of plots on current page with \Opt{Xc}, \Opt{Yc}.
\item More control over input/output table formats (\Opt{f}, \Opt{:}[{\bf i$|$o}]).
\item Ability to read and write NOAA/NGDC GRD98 grid format.
\item Ability to add additional fonts.
\item Custom paper media size (useful for posters and large maps).
\item All text are now justified by the \PS\ interpreter, as is the clipping of contours and ``quoted lines''
to make space for annotation labels.
\item Better support for various international character encodings.
\item New Appendices M (color tables), N (custom symbols), O (contours and ``quoted lines''), and P
(using both \GMT\ 3 and 4).
\item New hidden files \filename{.gmtdefaults4} and \filename{.gmtcommands4} to ensure peaceful coexistence with \GMT\ 3-series.
\item Data files in directories pointed to by the three environmental parameters {\bf \$GMT\_DATADIR}, {\bf \$GMT\_GRIDDIR},
and {\bf \$GMT\_IMGDIR} can be specified without their full path names when used as input files.
\item We have added five new examples for a total of 25.
\item Bourne shell utility \progname{gmtswitch} simplifies switching between installed \GMT\ versions.
\end{itemize}
\end{description}

