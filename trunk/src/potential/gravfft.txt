#include "common_options.txt"
.TH GRAVFFT 1 MANDATE GMT_STRING "Generic Mapping Tools [potential supplement]"
.SH NAME
gravfft \- Compute gravitational attraction of 3-D surfaces in the wavenumber (or frequency) domain
.SH SYNOPSIS
BD(gravfft) IT(ingrid) [ IT(ingrid2) ] OPT(G)IT(outfile) [ -C<n/wavelength/mean_depth/tbw> ]
[ OPT(A)IT(z_offset) ] [ OPT(D)<density> ] [ OPT(E)<n_terms> ] [ OPT(F)[f|g|v|n|e] ] [ OPT(I)<wbctk> ] [ OPT(L)[m|h|n] ]
[ OPT(N)[GMT_FFT_OPT] ] [ OPT(Q) ] [ OPT(T)<te/rl/rm/rw>[+m] ] [ GMT_V_OPT ] [ OPT(Z)<zm>[/<zl>] ] [ OPT(fg) ]
.SH DESCRIPTION
BD(gravfft) can be used into two main modes. First one computes the gravity/geoid response of a bathymetry file. It will
take the 2-D forward FFT of a bathymetry grid and compute it’s gravity/geoid response using full Parker’s method applied
to the chosen model. The available models are the “loading from top”, or elastic plate model, and the “loading from below”
which accounts for the plate’s response to a sub-surface load (appropriate for hot spot modeling - if you believe them).
In both cases, the model parameters are set with OPT(T) and OPT(Z) options. Second mode computes the admittance or 
coherence between two grids. The output is the average in the radial direction. Optionally, the model admittance may also
be calculated. The horizontal dimensions of the grdfiles are assumed to be in meters. Geographical grids may be used by
specifying the OPT(fg) option that scales degrees to meters. If you have grids with dimensions in km, you could change
this to meters using BD(grdedit) or scale the output with BD(grdmath). Given the number of choices this program offers,
is difficult to state what are options and what are required arguments. It depends on what you are doing. 
#include "explain_commonitems.txt"
.SH REQUIRED ARGUMENTS
.TP
IT(ingrid)
2-D binary grid file to be operated on.
(See GRID FILE FORMATS below).  For cross-spectral operations, also give the second grid file IT(ingrd2).
.TP
OPT(G)IT(outfile)
Specify the name of the output grid file or the 1-D spectrum table (see OPT(E)).
(See GRID FILE FORMATS below).
.SH OPTIONAL ARGUMENTS
.TP
OPT(C)IT(<n/wavelength/mean_depth/tbw>)
Compute only the theoretical admittance curves of the selected model and exit. IT(n) and IT(wavelength) are used to
compute (n * wavelength) the total profile length in meters. IT(mean_depth) is the mean water depth. Append
dataflags (one or two) of IT(tbw) in any order. IT(t) = use “from top” model, IT(b) = use “from below” model.
Optionally specify IT(w) to write wavelength instead of frequency.
.TP
OPT(D)IT(density)
Sets density contrast across surface. Used, for example, to compute the gravity attraction of the water layer that
can later be combined with the free-air anomaly to get the Bouguer anomaly. In this case do not use OPT(T).
It also implicitly sets OPT(L)
.TP
OPT(E)IT(n_terms)
Number of terms used in Parker expansion (limit is 10, otherwise terms depending on n will blow out the program)
[Default = 1]
.TP
OPT(F)[BD(f)|BD(g)|BD(v)|BD(n)|BD(e)]
Specify desired geopotential field: compute geoid rather than gravity
.sp
BD(f) = Free-air anomalies (mGal) [Default].
.sp
BD(g) = Geoid anomalies (m).
.sp
BD(v) = Vertical Gravity Gradient (VGG; 1 Eovtos = 0.1 mGal/km).
.sp
BD(e) = East deflections of the vertical (micro-radian).
.sp
BD(n) = North deflections of the vertical (micro-radian).
.TP
OPT(I)IT(<wbctk>)
Use <ingrid2> and <topo_grd> to estimate admittance|coherence and write it to stdout (-G ignored if set).
This grid should contain gravity or geoid for the same region of <topo_grd>. Default computes admittance.
Output contains 3 or 4 columns. Frequency (wavelength), admittance (coherence) one sigma error bar and,
optionally, a theoretical admittance. Append dataflags (one to three) of wbct.
BD(w) writes wavelength instead of wavenumber
BD(k) Use km or wavelength unit [m]
BD(c) computes coherence instead of admittance
BD(b) writes a forth column with "loading from below" theoretical admittance
BD(t) writes a forth column with "elastic plate" theoretical admittance
.TP
OPT(L)[BD(m)|BD(h)|BD(n)]
Leave trend alone.  By default, a linear trend will be removed prior to the transform.
Alternatively, append BD(m) to just remove the mean value, BD(h) to remove the mid-value,
or BD(n) to not remove constant/plane from input data.
#define FFT_OPT OPT(N)
#include "explain_fft.txt" 
.TP
OPT(Q)
Writes out a grid with the flexural topography (with z positive up) whose average was set by OPT(Z)IT(zm)
and model parameters by OPT(T) (and output by OPT(G)). That is the “gravimetric Moho”.
OPT(Q) implicitly sets OPT(L)
.TP
OPT(S)
Computes predicted gravity or geoid grid due to a subplate load produced by the current bathymetry and the
theoretical model. The necessary parameters are set within OPT(T) and OPT(Z) options. The number of powers in
Parker expansion is restricted to 1 (default’s). See an example further down.
.TP
OPT(Z)IT(<zm>[/<zl>])
Moho [and swell] average compensation depths. For the “load from top” model you only have to provide IT(zm),
but for the “loading from below” don’t forget IT(zl).
.TP
#include "explain_-V.txt" 
.TP
OPT(fg)
Geographic grids (dimensions of longitude, latitude) will be converted to meters via a "Flat Earth" approximation
using the current ellipsoid parameters.
#include "explain_help.txt"
#include "explain_grd_inout.txt"
.SH GRID DISTANCE UNITS
If the grid does not have meter as the horizontal unit, supply BD(+u)IT(unit) to the input file name to convert from the
specified unit to meter.  If your grid is geographic, convert distances to meters by supplying OPT(fg) instead.
.SH CONSIDERATIONS
netCDF COARDS grids will automatically be recognized as geographic. For other grids geographical grids
were you want to convert degrees into meters, select OPT(fg).  If the data are close to either pole,
you should consider projecting the grid file onto a rectangular coordinate system using BD(grdproject).
.SH EXAMPLES
To compute the effect of the water layer above the bat.grd bathymetry using 2700 and 1035 for the
densities of crust and water and writing the result on water_g.grd (computing up to the fourth power of
bathymetry in Parker expansion):
.br
.sp
gravfft bat.grd -D1665 -Gwater_g.grd -E4
.br
.sp
Now subtract it to your free-air anomaly faa.grd and you’ll get the Bouguer anomaly. You may wonder why
we are subtracting and not adding. After all the Bouger anomaly pretends to correct the mass deficiency
presented by the water layer, so we should add because water is less dense than the rocks below. The answer
relyies on the way gravity effects are computed by the Parker’s method and practical aspects of using the FFT.
.br
.sp
grdmath faa.grd water_g.grd SUB = bouguer.grd
.br
.sp
Want an MBA anomaly? Well compute the crust mantle contribution and add it to the sea-bottom anomaly.
Assuming a 6 km thick crust of density 2700 and a mantle with 3300 density we could repeat the command used
to compute the water layer anomaly, using 600 (3300 - 2700) as the density contrast. But we now have a problem
because we need to know the mean moho depth. That is when OPT(A) option comes in hand. Notice that we didn’t need
to do that before because mean water depth was computed directly from data. (notice also the negative sign
of the argument to OPT(A), remember z positive up):
.br
.sp
gravfft bat.grd -D600 -Gmoho_g.grd -A-6000
.br
.sp
Now, add it to the sea-bottom anomaly to obtain the MBA anomaly. That is:
.br
.sp
grdmath water_g.grd moho_g.grd ADD = mba.grd
.br
.sp
To compute the Moho gravity effect of an elastic plate bat.grd with Te = 7 km, density of 2700, over a
mantle of density 3300, at an averge depth of 9 km
.br
.sp
gravfft bat.grd -Gelastic.grd -T7000/2700/3300/1035+m -Z9000
.br
.sp
If you add now the sea-bottom and Moho’s effects, you’ll get the full gravity response of your isostatic model.
We will use here only the first term in Parker expansion (default).
.br
.sp
gravfft bat.grd -D1665 -Gwater_g.grd
.br
.sp
gravfft bat.grd -Gelastic.grd -T7000/2700/3300/1035+m -Z9000
.br
.sp
grdmath water_g.grd elastic.grd ADD = model.grd
.br
.sp
The same result can be obtained directly by the next command. However, PAY ATTENTION to the following.
I don’t yet know if it’s because of a bug or due to some limitation, but the fact is that the
following and the previous commands only give the same result if OPT(E)1 (the default) is used. For higher
powers of bathymetry in Parker expansion, only the above example seams to give the correct result.
.br
.sp
gravfft bat.grd -Gmodel.grd -T7000/2700/3300/1035 -Z9000 -L
.br
.sp
And what would be the geoid anomaly produced by a load at 50 km depth, below the a region whose bathymetry
is given by bat.grd, a Moho at 9 km depth and the same densities as before?
.br
.sp
gravfft topo.grd -Gswell_geoid.grd -T7000/2700/3300/1035 -F -Z9000/50000 -S
.br
.sp
To compute the admittance between the topo.grd bathymetry and faa.grd free-air anomaly grid using the
elastic plate model of a crust of 6 km mean thickness with 10 km efective elastic thickness in a region
of 3 km mean water depth:
.br
.sp
gravfft topo.grd faa.grd -It -T10000/2700/3300/1035 -Z9000
.br
.sp
To compute the admittance between the topo.grd bathymetry and geoid.grd geoid grid with the
“loading from below” (LFB) model with the same as above and sub-surface load at 40 km, but assuming now
the grids are in geographic and we want wavelengths instead of frequency:
.br
.sp
gravfft topo.grd geoid.grd -Ibw -T10000/2700/3300/1035 -Z9000/40000 -fg
.br
.sp
To compute the gravity theoretical admittance of a LFB along a 1000 km long profile using the same
 parameters as above
.br
.sp
gravfft -C400/5000/3000/b -T10000/2700/3300/1035 -Z9000/40000
.SH REFERENCES
Luis, J.F. and M.C. Neves. 2006, "The isostatic compensation of the Azores Plateau:
a 3D admittance and coherence analysis. J. Geotermal Vulc. Res. Volume 156, Issues 1-2, 
Pages 10-22, http://dx.doi.org/10.1016/j.jvolgeores.2006.03.010
.SH "SEE ALSO"
.IR gmt (1),
.IR grdfft (1),
.IR grdmath (1),
.IR grdproject (1)
