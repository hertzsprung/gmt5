.TH GMTMATH l DATE
.SH NAME
gmtmath \- Reverse Polish Notation calculator for data tables
.SH SYNOPSIS
\fBgmtmath\fP [ \fB\-A\fP\fIt_f(t).d\fP ] [ \fB\-C\fP\fIcols\fP ] [ \fB\-H\fP\fInrec\fP ] [ \fB\-N\fP\fIn_col\fP/\fIt_col\fP ] [ \fB\-Q\fP ] 
 [ \fB\-S\fP ][ \fB\-T\fP\fIt_min/t_max/t_inc\fP|\fItfile\fP ] [ \fB\-V\fP ] [ \fB\-bi\fP[\fBs\fP][\fIn\fP] ] 
[ \fB\-bo\fP[\fBs\fP][\fIn\fP] ] 
\fIoperand\fP [ \fIoperand\fP ] \fBOPERATOR\fP [ \fIoperand\fP ] \fBOPERATOR\fP ... \fB=\fP [ \fIoutfile\fP ]
.SH DESCRIPTION
\fBgmtmath\fP will perform operations like add, subtract, multiply, and divide on one or more table data files or constants using
Reverse Polish Notation (RPN) syntax (e.g., Hewlett-Packard calculator-style).  Arbitrarily complicated expressions may therefore
be evaluated; the final result is written to an output file [or standard output].  When two data tables are
on the stack, each element in file A is modified by the corresponding element in file B.
However, some operators only require one operand (see below).  If no data tables are used in the
expression then options \fB\-T, \-N\fP must be set (and optionally \fB\-b\fP).  By default, all columns except the "time" column are operated on, but this can be changed (see \fB\-C\fP).
.TP
\fIoperand\fP
If \fIoperand\fP can be opened as a file it will be read as an ASCII (or binary, see \fB\-bi\fP) table data file.  If not a file, it is interpreted
as a numerical constant or a special symbol (see below).
.TP
\fIoutfile\fP is a table data file that will hold the final result.  If not given then
the output is sent to stdout.
.TP
.B OPERATORS
Choose among the following operators:
.br
Operator	n_args	Returns
.br
.sp
#include "gmtmath_man.i"
.TP
.B SYMBOLS
The following symbols have special meaning:
.br
.sp
\fBPI\fP	3.1415926...
.br
\fBE \fP	2.7182818...
.br
\fBT \fP	Table with t-coordinates
.br
.SH OPTIONS
.TP
.B \-A
Requires \fB\-N\fP and will partially initialize a table with values from the given file containing
\fIt\fP and \fIf(t)\fP only.  The \fIt\fP is placed in column \fIt_col\fP while \fIf(t)\fP goes into
column \fIn_col\fP - 1 (see \fB\-N\fP).
.TP
.B \-C
Select the columns that will be operated on until next occurrence of \fB\-C\fP.
List columns separated by commas; ranges like 1,3-5,7 are allowed.  \fB\-C\fP
(no arguments) resets the default action of using all columns except time column (see \fB\-N\fP). 
\fB\-Ca\fP selects all columns, including time column, while \fB\-Cr\fP reverses (toggles) the current
choices.
#include "explain_-H.txt"
.TP
.B \-N
Select the number of columns and the column number that contains the
"time" variable.  Columns are numbered starting at 0 [2/0].
.TP
.B \-Q
Quick mode for scalar calculation.  Shorthand for \fB\-Ca \-N\fP1/0 \fB\-T\fP0/0/1.
.TP
.B \-S
Only report the first row of the results [Default is all rows].  This is useful if
you have computed a statistic (say the \fBMODE\fP) and only want to report a single number
instead of numerous records with identical values.
.TP
.B \-T
Required when no input files are given.  Sets the t-coordinates of the first
and last point and the equidistant sampling interval for the "time" column (see \fB\-N\fP).
If there is no time column (only data columns), give \fB\-T\fP with no arguments; this
also implies \fB\-Ca\fP.  Alternatively, give the name of a file whose first column
contains the desired t-coordinates which may be irregular.
#include "explain_-V.txt"
#include "explain_-i.txt"
#include "explain_-n.txt"
#include "explain_-o.txt"
#include "explain_-n.txt"
.SH BEWARE
The operator \fBPLM\fP calculates the associated Legendre polynomial
of degree L and order M, and its argument is the cosine of the colatitude
which must satisfy -1 <= x <= +1. \fBPLM\fP is not normalized.
.br
All derivatives are based on central finite differences, with natural
boundary conditions.
.SH EXAMPLES
To take log10 of the average of 2 data files, use
.br
.sp
\fBgmtmath\fP file1.d file2.d \fBADD\fP 0.5 \fBMUL LOG10 \=\fP file3.d
.br
.sp
Given the file samples.d, which holds seafloor ages in m.y. and seafloor depth in m, use the relation
depth(in m) = 2500 + 350 * sqrt (age) to print the depth anomalies:
.br
.sp
\fBgmtmath\fP samples.d \fBT SQRT\fP 350 \fBMUL \fP2500 \fBADD SUB \=\fP | lpr
.br
.sp
To take the average of columns 1 and 4-6 in the three data sets sizes.1, sizes.2, and sizes.3, use
.br
.sp
\fBgmtmath\fP \fB\-C\fP1,4-6 sizes.1 sizes.2 \fBADD\fP sizes.3 \fBADD 3 DIV \=\fP ave.d
.br
.sp
To take the 1-column data set ages.d and calculate the modal value and assign it to a variable, try
.br
.sp
set mode_age = `\fBgmtmath\fP \fB\-S \-T\fP ages.d \fBMODE \=\fP`
.br
.sp
To evaluate the dilog(x) function for coordinates given in the file t.d:
.br
.sp
\fBgmtmath\fP \fB\-T\fPt.d \fBT DILOG \=\fP dilog.d
.br
.sp
To use gmtmath as a RPN Hewlett-Packard calculator on scalars (i.e., no input
files) and calculate arbitrary expressions, use the \fB\-Q\fP option.
As an example, we will calculate the value of Kei (((1 + 1.75)/2.2) + cos (60))
and store the result in the shell variable z:
.br
.sp
set z = `\fBgmtmath\fP \fB\-Q\fP 1 1.75 \fBADD\fP 2.2 \fBDIV\fP 60 \fBCOSD ADD KEI \=\fP`
.br
.sp
To use \fBgmtmath\fP as a general least squares equation solver, imagine that the current table is the
augmented matrix [ A | b ] and you want the least squares solution x to the matrix equation A * x = b.
The operator \fBLSQFIT\fP does this; it is your job to populate the matrix correctly first.  The \fB\-A\fP
option will facilitate this.  Suppose you have a 2-column file ty.d with \fIt\fP and \fIb(t)\fP and you would
like to fit a the model y(t) = a + b*t + c*H(t-t0), where H is the Heaviside step function for a given t0 = 1.55.
Then, you need a 4-column augmented table loaded with t in column 0 and your observed y(t) in column 3.
The calculation becomes
.br
.sp
\fBgmtmath\fP \fB\-N\fP4/1 \fB\-A\fPty.d \fB-C\fP0 1 \fBADD \-C\fP2 1.55 \fBSTEPT ADD \-Ca LSQFIT \=\fP solution.d
.br
.sp
Note we use the \fB\-C\fP option to select which columns we are working on, then make active all the
columns we need (here all of them, with \fB\-Ca\fP) before calling \fBLSQFIT\fP.  The second and fourth
columns are preloaded with t and y(t), respectively, the other columns are zero.  If you already have
a precalculated table with the augmented matrix [ A | b ] in a file (say lsqsys.d), the least squares
solution is simply
.br
.sp
\fBgmtmath\fP \fB\-T\fP lsqsys.d \fBLSQFIT \=\fP solution.d
.SH BUGS
Files that have the same name as some operators, e.g., \fBADD\fP, \fBSIGN\fP, \fB=\fP, etc. cannot be read
and must not be present in the current directory.  Piping of files is not allowed on input, but the output can be sent to stdout.
The stack limit is hard-wired to 50.
All functions expecting a positive radius (e.g., \fBLOG\fP, \fBKEI\fP, etc.) are passed the
absolute value of their argument.  The \fBDDT\fP and \fBD2DT2\fP functions only work on regularly spaced data.
.SH REFERENCES
Abramowitz, M., and I. A. Stegun, 1964, \fIHandbook of Mathematical
Functions\fP, Applied Mathematics Series, vol. 55, Dover, New York.
.br
Press, W. H.,  S. A. Teukolsky, W. T. Vetterling, B. P. Flannery, 1992, 
\fINumerical Recipes\fP, 2nd edition, Cambridge Univ., New York.
.SH "SEE ALSO"
.IR gmt (l),
.IR grd2xyz (l),
.IR grdedit (l),
.IR grdinfo (l),
.IR grdmath (l),
.IR xyz2grd (l)
