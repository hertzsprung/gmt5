%------------------------------------------
%	$Id: GMT_Chapter_1.tex,v 1.26 2005-12-13 20:04:08 remko Exp $
%
%	The GMT Documentation Project
%	Copyright 2000-2005.
%	Paul Wessel and Walter H. F. Smith
%------------------------------------------
%
\chapter{Preface} 
\label{ch:1}
\thispagestyle{headings}

While \GMT\ has served the map-making and data processing needs of scientists since 1988\footnote{Version
1.0 was then informally released at the Lamont-Doherty Earth Observatory.}, the current global use was
heralded by the first official release in {\it EOS Trans. AGU} in the fall of 1991.  Since then,
\GMT\ has grown to become a standard tool for many users, particularly in the Earth and Ocean Sciences.
Development has at times been rapid, and numerous releases have seen the light of day since the early
versions.  For a history of the changes from release to release, see the online
\htmladdnormallink{Release Announcements}{http://gmt.soest.hawaii.edu/gmt/gmt_releases.html}
and the file \filename{CHANGES} in the main \GMT\ directory.

The success of \GMT\ is to a large degree due to the input of the user community. In fact, most of the
capabilities and options in \GMT\ programs originated as user requests.
We would like to hear from you should you have any suggestions for future enhancements and modification.
Please send your comments to
\htmladdnormallink{the GMT help list}{mailto:gmt-help@hawaii.edu}.

\section{What is new in \gmt\ 4.x?}

\GMT\ 4.x continues to see both development of new features as well as corrections of
legacy bugs and problems.  It is likely we will continue to do so for a while until we
reach a stable point from which we can initiate the \GMT\ 5 development branch.  \GMT\ 5
will be distinguished by being completely restructured so as to allow developers to call
high-level \GMT\ processes from a variety of programming environments.  Below is a brief
history of the development milestones in the 4.x series.

\subsection{Overview of \gmt\ 4.1}

Most changes in \GMT\ 4.1 are improvements ``under the hood''.  The most significant of these are

\begin{enumerate}
\item Addition of ability to both read and write netCDF files that are COARDS compliant.  This means
that \GMT, for the first time, is able to read netCDF files created by applications other than itself,
and that other applications capable of reading COARDS-compliant netCDF grids can directly import data
from \GMT.  We have added the new parameter {\bf GRID\_FORMAT} to the  \GMT\ defaults with ``nf'' as default.
Users who, against our recommendation, prefer to maintain the old non-COARDS compliant format as their
default grid format can instead select ``cf''.
\item An overhaul of how the {\bf pslib} library encodes \PS\ images, resulting in vastly smaller files when
certain conditions are met, and general shrinking overall by enabling RLE or LZW compression.  We
have also added hooks for setting three new \PS\ parameters via \GMTprog{gmtdefaults} settings:
{\bf PS\_LINE\_CAP}, {\bf PS\_LINE\_JOIN}, and {\bf PS\_MITER\_LIMIT}. See \GMTprog{gmtdefaults} for details.
\item Adjustments to how native \GMT\ grid headers are read and written in order to be fully 64-bit safe.
\GMT\ now runs in full 64-bit mode on platforms that supports it (e.g., Mac OS X G5).
\item Making \GMT\ tread-safe by replacing {\it strtok} with our own {\it GMT\_strtok} function.
\item Implemented full inverse Winkel map projection based on a new algorithm by Ipbuker, 2002,
{\it Cartography \& Geographical Information Science, 29}, 37-42.
\item Extended the options that is used to specify grid spacing (usually \Opt{I}{\it xinc/yinc}) to allow for
specifying {\it nx/ny} instead (by appending +).  Also, append ! to adjust the range so it fits exactly the
given increment [by default the range is kept fixed and sloppy increments are adjusted accordingly].
Append {\bf e}$|${\bf k}$|${\bf i}$|${\bf n} for increments in meter, km, miles
or nautical miles, respectively.  These increments are converted to degrees
longitude (at the middle latitude) and degrees latitude.
\item We now have improved PDF layout and navigation (thanks to Misha Tchernychev).

\end{enumerate}

Many programs or options have received minor updates and new features, such as

\begin{description}
\item [\Opt{b}]: Ability to specify byte-swapping for native binary input and output tables by using upper
case {\bf S}$|${\bf D}.  This is useful if you have binary tables created on a little-endian machine (e.g.,
Linux PC) and need to read them on a big-endian machine (e.g., most RISC-chip machines from Sun, HP, Apple).
\item [\GMTprogi{grdraster.c}]: Optionally select a data set by giving a text pattern instead of data ID number.
This makes it easier to specify a certain data set (i.e., ``ETOPO2'') than having to remember its arbitrary numberical
ID.  Also, native grids with \GMT\ headers can also be placed in the database by appending {\bf H}{\it nbytes} to the
corresponding \filename{grdraster.info} entry, where {\it nbytes} is the size of the header that should be skipped
(use 892 for GMT headers).
\item [\GMTprogi{pslegend.c}]: Added layout option {\bf B} for inserting color bars via \GMTprog{psscale}.
\item [\GMTprogi{gmtmath.c}]: Added {\bf TN} function
for evaluating Chebyshev polynomials; new constant {\bf Tn} was added to easily select normalized {\bf T}
(gives coordinates from -1 to + 1 suitable for evaluating Legendre and Chebyshev polynomials).
Finally, we added {\bf CORRCOEFF} for calculation of correlation coefficients, and \Opt{I} to reverse
the output by printing the last row first.
\item [\GMTprogi{grdmath.c}]: Allow \Opt{bi} to be used with input files for commands {\bf PDIST}, {\bf LDIST},
and {\bf INSIDE}.  When spherical calculations are selected we now use the {\bf ELLIPSOID} setting to
determine if distance calculations should be along geodesics or great circles.  Also added {\bf TN} function
for evaluating Chebyshev polynomials; new constants {\bf Xn} and {\bf Yn} was added to easily select
normalized {\bf X} and {\bf Y}.  Finally, we added {\bf CORRCOEFF} for calculation of correlation coefficients.
\item [\GMTprogi{pshistogram.c}]: New option \Opt{T}{\it col} lets user select any column to be used, starting
with 0 (first).  The old \Opt{2} option is retired (but remains accessible for backwards compatibility).  
\item [\GMTprogi{gmtconvert.c}]: New \Opt{N} option suppresses output records when all fields are NaNs.
\item [\GMTprogi{psimage.c}]: Now support inclusion of EPS images.
\item [\GMTprogi{mapproject.c}]: \Opt{L} now outputs both the minimum distance and the coordinates
of the nearest point on the line.
\item [\GMTprogi{filter1d.c}]: Allow NaNs in all but the ``independent data'' column.
\item [\GMTprogi{sample1d.c}]: Allow NaNs in all but the ``independent data'' column.
\item [\GMTprogi{grdgradient.c}]: Added option \Opt{E} for Lambertian or Peuckeer illumination.
\item [\GMTprogi{grd2xyz.c}]: Added \Opt{E} for ESRI interchange ASCII grid dump.
\item [\GMTprogi{xyz2grd.c}]: Added \Opt{E} for ESRI interchange ASCII grid digest.
\item [\GMTprogi{pscoast.c}]: Added \Opt{Z} for 3-D map z-level (as in \GMTprog{psbasemap} and others).
\item [\GMTprogi{psxyz.c}]: Added \Opt{Q} to disable sorting of points based on distance.
\end{description}

Inevitably, when new features are added, new bugs come along with them.  Below is a list of problems
that we have identified and corrected in the current release:.

\begin{description}
\item [\GMTprogi{install\_gmt}]: No longer test netcdf installation since that can fail even when install was
successful [e.g., under Mac OS X Tiger].
\item [\GMTprogi{gmt.h}]: \GMTfunc{GMT\_swab4} used {\tt unsigned long} instead of {\tt unsigned int} which could cause
64-bit problems.
\item [\GMTprogi{gmt\_time\_system.h}]: Fixed MJD offsets by subtracting 10 days.
\item [\GMTprogi{gmt\_calclock.c}]: time to hr,min,sec was vulnerable to round-off when optimized.  Also, {\it hh:mm} data
(without trailing {\it :ss}) would loose the minutes ({\it hh:mm:ss} was OK).
\item [\GMTprogi{gmt\_grdio.c}]: Bug in scale/offset for \GMTprog{grdblend}'s row-by-row i/o.
\item [\GMTprogi{gmt\_init.c}]: Would eat number with leading plus sign without checking if it actually was
a +\filename{gmtdefaults} file instruction; thus \GMTprog{gmtmath} could not see numbers such as +13.5.
Command line argument --{\bf BASEMAP\_FRAME\_RGB}={\it color} was not passed through to tick-, grid- and
annotation-properties.  \GMTfunc{GMT\_end} now frees memory used for hashing.
\item [\GMTprogi{gmt\_io.c}]: Bug in reading {\it yyyy}[/]{\it jjj} data fixed.  \GMTfunc{GMT\_lines\_init}
had trouble if 2000 segments had no data at all.  it also allocated 2000 points for each segment but never
deallocated the unused portions, thus running up memory fast.  \GMTfunc{GMT\_write\_segmentheader} wrote nothing
if input was binary and output is ASCII.  Fixed a few memory leaks
\item [\GMTprogi{gmt\_map.c}]: Azimuth to angle calculation for linear projections now properly handle different
scales in x and y. The calculation was also vulnerable to bad wrap-around, giving strange directions for
vectors in \GMTprog{psxy}. Geodesic distance calculation could get wrong quadrant.  
\item [\GMTprogi{gmt\_plot.c}]: 360\DS\ polar basemaps could lack outline.  Direction for map roses were inaccurate.
circle and theta-r boundaries did not allocate enough memory for arrays.  Would plot both -180 and +180 annotations
for periodic maps.
\item [\GMTprogi{gmt\_shore.c}]: Must explicitly close polygons since inside/outside test in other programs expects it.
\item [\GMTprogi{gmt\_support.c}]: Trouble extracting subregions of grid with {\it east} = 0.  Cartesian {\bf LDIST} failed
when mininum distance was requested (only done via \GMTprog{grdmath}).  Color names got truncated to 16 characters.
Improved workings of \GMTfunc{GMT\_sample\_cpt} in support of \GMTprog{makecpt}.  Fixed more memory leaks.
Bad LF/CR removal for \filename{coastline.conf} dir.
\item [\GMTprogi{filter1d.c}]: \Opt{Ff} with even number of coefficients sometimes skip a coefficient.
\item [\GMTprogi{gmtconvert.c}]: Missed first multisegment output header if input file was ASCII.
\item [\GMTprogi{gmtmath.c}]: No longer have to say \Opt{Ca} if there is only one input column.  Did not understand
{\it date}{\bf T}{\it clock} as command line data.
\item [\GMTprogi{gmtselect.c}]: If \Opt{M} is on and a portion of a segment is skipped, we must
reissue the multisegment header when segment resumes.  Now handles both Cartesian
and spherical polygons correctly.
\item [\GMTprogi{grd2xyz.c}]: Sloppy \Opt{R} resulted in bad x,y values and sometimes allocation error
\item [\GMTprogi{grdgradient.c}]: If \Opt{M} is used with grids that include poles, ignore the poles
when normalizing the slopes.
\item [\GMTprogi{grdimage.c}]: Cannot use \Opt{R} to extract subset when \Opt{J} is oblique.  Reverse log-axes did not work.
\item [\GMTprogi{grdmask.c}]: Now handles both Cartesian and spherical well
\item [\GMTprogi{grdmath.c}]: Wrong sign in {\bf D2DY2}, and bogus value at {\it y = ymin}.  Now handles both Cartesian
and spherical polygons correctly.  Constants given on command line can now be absolute time, geographic coordinates, or
regular floating-point numbers.
\item [\GMTprogi{grdview.c}]: Cannot use \Opt{R} to extract subset when \Opt{J} is oblique.
\item [\GMTprogi{grdvolume.c}]: \Opt{C}{\it low/high/delta} did not check for {\it low} < {\it high}, etc.
\item [\GMTprogi{pscoast.c}]: Recursive painting could get tricked when boundaries were curved.
\item [\GMTprogi{pslegend.c}]: Did not pass +\filename{gmtdefaults} and --{\bf PAR}={\it val} onto system calls.
\item [\GMTprogi{psscale.c}]: Vertical annotations w/custom {\bf D\_FORMAT} were not aligned. Now uses more optimal means
to display the color bar, leading to smaller \PS\ files.
\item [\GMTprogi{psxy.c}]: \Opt{Sp} is now a true point, but can also take an optional size.
\item [\GMTprogi{psxyz.c}]: Wrong index used in assigning color from cpt and in updating vector lengths.
\item [\GMTprogi{spectrum1d.c}]: Bugs in error expressions for admittance, gain, and phase have been corrected.
\item [\GMTprogi{x2sys \& mgd77}]: Made DOS-format (CR/LF) tolerant.  Both supplements are now undergoing rapid
development.
\end{description}

\subsection{Overview of \gmt\ 4.0}

\GMT\ 4 represents a major overhaul of the package, hence the major version number increment.  There are four
categories of changes that have been implemented:
\begin{description}
\item [Time-series support.]  \GMT\ can now read and write time-series data where
the time coordinates are of the form {\it date}{\bf T}{\it clock}\footnote{Use standard
\UNIX\ tools such as \progname{awk} or \progname{perl} to reformat files should
your {\it date} and {\it clock} components reside in separate columns.}.  The formats
used for {\it date} and {\it clock} are under the user's control.  Both Gregorian
and ISO calendars are supported.  Frame annotation for time-series are now supported
via the \Opt{B} option; there are many new modifiers reflecting the vast number of
ways one may want to annotate time axes, including support for primary and secondary
annotation levels and the day- and month-names in numerous languages (send us the information
we need if your language is not supported).  The capability to handle time (in \Opt{R},
\Opt{J}, \Opt{B}, i/o, and plotting) required considerable changes ``under the hood'',
including the introduction of numerous new \GMTprog{gmtdefaults} parameters to make
the time series support as ``generic'' as we need it to be.
\item [New Tools.]  Three new tools have been added:
\begin{enumerate}
\item \GMTprog{gmt2rgb}: Makes red, green, and blue component gridfiles from an image (to be
used with new options for false color imaging or image draping by \GMTprog{grdimage} or \GMTprog{grdview}).
\item \GMTprog{grdblend}: Blends several partially over-lapping grdfiles into one combined grid.  Output
grid is written one row at the time so truly enormous grids can be created.
\item \GMTprog{pslegend}: Designs and plots elaborate legends on maps.
\end{enumerate}
\item [New Program Options.]  Many programs have received additional options or
features that enhances their usefulness:
\begin{itemize}
\item \GMTprog{blockmean}:	New option \Opt{Sw} will return weight sum while \Opt{Sz} returns
the data sums (i.e., it duplicates the previous \Opt{S} option).
\item \GMTprog{filter1d}:	New filters \Opt{Fl$|$L$|$u$|$U} that return extreme (min, max) values.
\item \GMTprog{gmtconvert}:	Added new options \Opt{F}, \Opt{A},  and \Opt{I} that simulate
\UNIX\ \progname{cut}, \progname{paste}, and \progname{tail} \Opt{r} (or \progname{tac}) capabilities.
Option \Opt{E} reports first and last point per segment only, \Opt{L} lists the segment headers only,
while \Opt{S} lists records from segments whose header matches a given text pattern.
\item \GMTprog{gmtmath}:	Added new operators for solving least squares problems ({\bf COL, LSQFIT}),
finding function roots ({\bf ROOTS}), and evaluating critical values ({\bf CHICRIT, FCRIT, TCRIT, ZCRIT}).
We also added some general functions ({\bf SINC, LOG2, LRAND}) and miscellaneous operations ({\bf FLIPUD, NEQ}).
The \Opt{S} option may now take a modifier to select first or last record only.
\item \GMTprog{gmtselect}:	New option  \Opt{Z} to pass or skip based on input $z$-range.
\item \GMTprog{grd2cpt}:	New options  \Opt{Q} for logarithmic scales, \Opt{E} for equidistant color
intervals, \Opt{R} for selecting a grid sub-region, and \Opt{N} to suppress output of B, F, N colors\footnote{Used
to color the background, foreground, and Not-a-Number areas.}.
\item \GMTprog{grd2xyz}:	New option \Opt{W} to write a constant weight factor as a 4th output column,
and ability to process several grid files at the same time.
\item \GMTprog{grdcontour}:	Expanded the \Opt{G} option to handle 5 algorithms (4 new) for the placement
of contour labels. 
\item \GMTprog{grdedit}:	New option \Opt{N} to replace selected node values given {\it x, y, z} data
in table form (options \Opt{H}, \Opt{b}, \Opt{f}, and \Opt{:} added for file support).
\item \GMTprog{grdfilter}:	New geospatial filters \Opt{Fl$|$L$|$u$|$U} that return extreme (min, max) values. 
\item \GMTprog{grdimage}:	New option for colormasking (\Opt{Q}; \PS\ Level 3 only), \PS\ image 
interpolation (\Opt{E}{\it -dpi}), and false RGB color image (when given three grids), as well as a modifier to \Opt{T}
to draw tile outlines.
\item \GMTprog{grdinfo}:	New option to create argument for \GMTprog{makecpt} (\Opt{T}) and to round-off
region boundary coordinates (\Opt{I}). 
\item \GMTprog{grdmath}:	Added new operators for critical values ({\bf CHICRIT, FCRIT, TCRIT, ZCRIT}),
geospatial analysis ({\bf LDIST,  PDIST, INSIDE}) and for calculating azimuths ({\bf CAS, SAZ}).  We have
also added some general functions ({\bf SINC, LOG2, LRAND}) and a few grid operations ({\bf FLIPLR, FLIPUD, ROTX, ROTY, NEQ,
INRANGE}).  We may now create multiple output grids from a single command.
\item \GMTprog{grdproject}: Option to supply false easting/northing or other offsets from the origin(\Opt{C}).
\item \GMTprog{grdreformat}: Option to suppress header in raw output (\Opt{N}).
\item \GMTprog{grdsample}:	Option to push the bilinear interpolation closer to nodes that are NaN (\Opt{Q}).
\item \GMTprog{grdtrack}:	Options to retrieve nearest node value (\Opt{N}, no interpolation) and to push
the bilinear interpolation closer to nodes that are NaN (\Opt{Q}).
\item \GMTprog{grdview}:	Colormasking (\Opt{Qc}, PS Level 3 only), draping of images via red, green,
and blue component grids (\Opt{G}).  Also,  drapegrids can have higher resolution than the relief grid, and we
added a modifier to \Opt{T} to draw tile outlines.
\item \GMTprog{makecpt}:	New options \Opt{Q} for logarithmic scales and \Opt{N} to suppress output
of B, F, N colors.
\item \GMTprog{mapproject}:	New options for datum conversions (\Opt{T}, \Opt{E}, and \Opt{Q}), azimuth and
back-azimuth (\Opt{A}), distance to point (\Opt{G}) and line  (\Opt{L})calculations, and optional false easting/northing (\Opt{C}).
\item \GMTprog{minmax}:		Added \Opt{T}{\it dz} option to produce \Opt{T} string for \GMTprog{makecpt},
\Opt{E} for returning extreme records, and the \Opt{I} option was extended to handle any number of columns when \Opt{C} is used.
\item \GMTprog{psbasemap}:	Extended \Opt{L} to allow alternate label and justification, and added \Opt{T}
for directional rose ornament or magnetic compass directions.
\item \GMTprog{pscoast}:	Extended \Opt{L} to allow alternate label and justification, and added \Opt{T}
for directional rose ornament or magnetic compass directions.
\item \GMTprog{pscontour}:	Expanded the \Opt{G} option to handle 5 algorithms (4 new) for the placement
of contour labels. 
\item \GMTprog{psimage}:	\PS\ image interpolation (\Opt{W}{\it -xlength}), and justification option
in \Opt{C}.
\item \GMTprog{psscale}:	Options to annotate on opposite side (\Opt{A}) and to plot back or foreground
triangle only (\Opt{E}[{\bf b$|$f}] ).  Also, draw discrete color-key table with centered annotations by appending an optional
{\it gap} to the \Opt{L} option. 
\item \GMTprog{pstext}: 	New option \Opt{A} should azimuths rather than angles be given,
\item \GMTprog{psxy}: 	Line color control (via \Opt{C}), symbol position offset (with \Opt{D}), custom symbols access 
(with \Opt{Sk}; use any of the 35 (Appendix~\ref{app:N}) that come with \GMT\ or design your own), many new symbols (horizontal and vertical dashes,
pentagon, octagon, rectangle, double-headed and centered vectors), and annotated (``quoted'') lines with \Opt{Sq}.
\item \GMTprog{psxyz}: 	Same, plus a vertical dash symbol.
\item \GMTprog{xyz2grd}: 	Added \Opt{Au$|$l} for upper/lower value at each node.
\end{itemize}
\item [General enhancements.]  These affect most of the programs:
\begin{itemize}
\item The coastline data have been updated to GSHHS version 1.3.  About 50 or so polygons had lingering
crossovers and some had duplicate points or failed to close; these have now been fixed. Major
errors in the Puget Sound coastline have also been corrected.
\item New shorthand to repeat the most recently used projection (\Opt{J}).
\item Options for phase-shifting the stride and supplying a prefix for frame annotations (\Opt{B}).
\item Override \GMT\ defaults directly on the command line with any number of {--}{--}\emph{PAR=value} options.
\item Now choose from 63 ellipsoids and 223 datums, or use your own values.
\item Numerous new \GMT\ defaults parameters, mostly in support of time-series functionality.
\item Shorthand for global regions (\Opt{Rg} for \Opt{R}0/360/-90/90 and \Opt{Rd} for \Opt{R}-180/180/-90/90).
\item Full support for either RGB, HSV, or CMYK in pen/fill command-line options or in cpt files.
\item Support for English color names (e.g., red, lightbrown).
\item Choice of unit when specifying pen thickness (cm, inch, point).
\item Easier pen specification mechanism, with predefined names for certain pen thicknesses.
\item Centering of plots on current page with \Opt{Xc}, \Opt{Yc}.
\item More control over input/output table formats (\Opt{f}, \Opt{:}[{\bf i$|$o}]).
\item Ability to read and write NOAA/NGDC GRD98 grid format.
\item Ability to add additional fonts.
\item Custom paper media size (useful for posters and large maps).
\item All text are now justified by the \PS\ interpreter, as is the clipping of contours and ``quoted lines''
to make space for annotation labels.
\item Better support for various international character encodings.
\item New Appendices M (color tables), N (custom symbols), O (contours and ``quoted lines''), and P
(using both \GMT\ 3 and 4).
\item New hidden files \filename{.gmtdefaults4} and \filename{.gmtcommands4} to ensure peaceful coexistence with \GMT\ 3-series.
\item Data files in directories pointed to by the three environmental parameters {\bf \$GMT\_DATADIR}, {\bf \$GMT\_GRIDDIR},
and {\bf \$GMT\_IMGDIR} can be specified without their full path names when used as input files.
\item We have added five new examples for a total of 25.
\item Bourne shell utility \progname{gmtswitch} simplifies switching between installed \GMT\ versions.
\end{itemize}
\end{description}

