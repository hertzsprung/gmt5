#include "common_options.txt"
.TH DIMFILTER 1 MANDATE GMT_STRING "Generic Mapping Tools [misc supplement]"
.SH NAME
dimfilter \- Directional filtering of 2-D gridded files in the space (or time) domain
.SH SYNOPSIS
BD(dimfilter) IT(input_file.nc) OPT(D)IT(distance_flag) OPT(F)IT(<filtertype><width>)[IT(mode)] 
OPT(G)IT(output_file.nc) OPT(N)IT(<filtertype><n_sectors>) [ OPT(Q)IT(cols) ] 
[ GMT_I_OPT ] [ GMT_Rgeo_OPT ] [ OPT(T) ] [ GMT_V_OPT ] [ GMT_f_OPT ]
.SH DESCRIPTION
BD(dimfilter) will filter a IT(.nc) file in the space (or time) domain by dividing the given filter
circle into IT(n_sectors), applying one of the selected primary convolution or non-convolution filters
to each sector, and choosing the final outcome according to the selected secondary filter.  It computes
distances using Cartesian or Spherical geometries. The output IT(.nc) file can optionally be generated
as a subregion of the input and/or with a new OPT(I)ncrement.  In this way, one may have "extra
space" in the input data so that there will be no edge effects for the output grid.
If the filter is low-pass, then the output may be less frequently sampled than the
input. BD(-Q) is for the error analysis mode and only requires the total number of columns in the input
file, which contains the filtered depths.  Finally, one should know that BD(dimfilter) will not produce
a smooth output as other spatial filters do because it returns a minimum median out of IT(N) medians of
IT(N) sectors.  The output can be rought unless the input data is noise-free.  Thus, an additional
filtering (e.g., Gaussian via BD(grdfilter)) of the DiM-filtered data is generally recommended.
.SH REQUIRED ARGUMENTS
.TP
IT(input_file.nc)
The data grid to be filtered.
.TP
OPT(D)IT(distance_flag)
Distance IT(flag) tells how grid (x,y) relates to filter IT(width), as follows:
.sp
IT(flag) = 0:  grid (x,y) same units as IT(width), Cartesian distances.
.br
IT(flag) = 1:  grid (x,y) in degrees, IT(width) in kilometers, Cartesian distances.
.br
IT(flag) = 2:  grid (x,y) in degrees, IT(width) in km, dx scaled by cos(middle y), Cartesian distances.
.sp
The above options are fastest because they allow weight matrix to be computed only once.
The next three options are slower because they recompute weights for each latitude.
.sp
IT(flag) = 3:  grid (x,y) in degrees, IT(width) in km, dx scaled by cosine(y), Cartesian distance calculation.
.br
IT(flag) = 4:  grid (x,y) in degrees, IT(width) in km, Spherical distance calculation.
.TP
OPT(F)IT(<filtertype><width>)[IT(mode)]
Sets the primary filter type.  Choose among convolution and non-convolution filters.  Append the filter code followed
by the full diameter IT(width). Available convolution filters are:
.br
(BD(b)) Boxcar: All weights are equal.
.br
(BD(c)) Cosine Arch: Weights follow a cosine arch curve.
.br
(BD(g)) Gaussian: Weights are given by the Gaussian function.
.br
Non-convolution filters are:
.br
(BD(m)) Median: Returns median value.
.br
(BD(p)) Maximum likelihood probability (a mode estimator): Return modal value.
If more than one mode is found we return their average value.  Append - or + to
the filter width if you rather want to return the smallest or largest of the modal
values.
.TP
OPT(N)IT(<filtertype><n_sectors>)
Sets the secondary filter type and the number of bow-tie sectors. IT(n_sectors) must be integer and larger than 0.
When IT(n_sectors) is set to 1, the secondary filter is not effective.  Available secondary filters are:
.br
(BD(l)) Lower: Return the minimum of all filtered values.
.br
(BD(u)) Upper: Return the maximum of all filtered values.
.br
(BD(a)) Average: Return the mean of all filtered values.
.br
(BD(m)) Median: Return the median of all filtered values.
.br
(BD(p)) Mode: Return the mode of all filtered values.
.TP
OPT(G)IT(output_file.nc)
IT(output_file.nc) is the output of the filter.
.SH OPTIONAL ARGUMENTS
.TP
OPT(I)
IT(x_inc) [and optionally IT(y_inc)] is the output Increment. Append BD(m) to indicate minutes, or BD(c) to indicate seconds.
If  the new IT(x_inc), IT(y_inc) are NOT integer multiples of the old ones (in the input data), filtering will be considerably slower.
[Default:  Same as input.]
.TP
OPT(R)
IT(west), IT(east), IT(south), and IT(north) defines the Region of the output points.  [Default:  Same as input.]
.TP
OPT(T)
Toggle the node registration for the output grid so as to become the opposite of the input grid
[Default gives the same registration as the input grid].
.TP
OPT(Q)IT(cols)
IT(cols) is the total number of columns in the input text table file.  For this mode, it expects to read depths
consisted of several columns. Each column represents a filtered grid with a filter width, which can be
obtained by 'grd2xyz -Z'. The outcome will be median, MAD, and mean. So, the column with the medians is
used to generate the regional component and the column with the MADs is used to conduct the error analysis.
#include "explain_-V.txt"
#include "explain_-f.txt"
#include "explain_help.txt"
#include "explain_grd_inout.txt"
#include "explain_grd_coord.txt"
.SH EXAMPLES
Suppose that north_pacific_dbdb5.nc is a file of 5 minute bathymetry from 140E to 260E and 0N to 50N,
and you want to find the medians of values within a 300km radius (600km full width) of the output points,
which you choose to be from 150E to 250E and 10N to 40N, and you want the output values every 0.5 degree.
To prevent the medians from being biased by the sloping plane, you want to divide the filter circle into
6 sectors and to choose the lowest value among 6 medians. Using spherical distance calculations, you need:
.sp
BD(dimfilter) north_pacific_dbdb5.nc OPT(G)filtered_pacific.nc OPT(Fm)600 OPT(D)4 OPT(N)l6 OPT(R)150/250/10/40 OPT(I)0.5 OPT(V)
.sp
Suppose that cape_verde.nc is a file of 0.5 minute bathymetry from 32W to 15W and 8N to 25N, and you
want to remove small-length-scale features in order to define a swell in an area extending from 27.5W
to 20.5W and 12.5N to 19.5N, and you want the output value every 2 minute. Using cartesian distance calculations, you need:
.sp
BD(dimfilter) cape_verde.nc OPT(G)t.nc OPT(Fm)220 \OPT(Nl)8 OPT(D)2 OPT(R)-27.5/-20.5/12.5/19.5 OPT(I)2m OPT(V)
.br
BD(grdfilter) t.nc OPT(G)cape_swell.nc OPT(-Fg)50 OPT(D)2 OPT(V)
.sp
Suppose that you found a range of filter widths for a given area, and you filtered the given bathymetric
data using the range of filter widths (e.g., IT(f100.nc f110.nc f120.nc f130.nc)), and you want to
define a regional trend using the range of filter widths, and you want to obtain median absolute deviation
(MAD) estimates at each data point. Then, you will need to do:
.sp
BD(grd2xyz) f100.nc BD(-Z) > f100.d
.br
BD(grd2xyz) f110.nc BD(-Z) > f110.d
.br
BD(grd2xyz) f120.nc BD(-Z) > f120.d
.br
BD(grd2xyz) f130.nc BD(-Z) > f130.d
.br
BD(paste) f100.d f110.d f120.d f130.d > depths.d
.br
BD(dimfilter) depths.d BD(-Q)4 > output.z
.sp  
.SH LIMITATIONS
When working with geographic (lat, lon) grids, all three convolution filters (boxcar, cosine arch, and gaussian) will properly normalize
the filter weights for the variation in gridbox size with latitude, and correctly determine which nodes are needed for the convolution
when the filter "circle" crosses a periodic (0-360) boundary or contains a geographic pole.  However, the spatial filters, such as median and mode filters,
do not use weights and thus should only be used on Cartesian grids (or at very low latitudes) only.  If you want to apply such spatial
filters you should project your data to an equal-area projection and run dimfilter on the resulting Cartesian grid.
.SH SCRIPT TEMPLATE
The dim.template.sh is a skeleton shell script that can be used
to set up a complete DiM analysis, including the MAD analysis.
.SH REFERENCE
Kim, S.-S., and Wessel, P. (2008), Directional Median Filtering
for Regional-Residual Separation of Bathymetry, IT(Geochem. Geophys. Geosyst.),
BD(9), Q03005, doi:10.1029/2007GC001850. 
.SH "SEE ALSO"
.IR GMT (1),
.IR grdfilter (1)
